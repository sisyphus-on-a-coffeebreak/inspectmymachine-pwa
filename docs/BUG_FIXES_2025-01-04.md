# Bug Fixes - January 4, 2025

## Issues Fixed

### 1. ✅ Analytics Vitals 400 Bad Request Error

**Problem:**
- Frontend was making POST requests to `/v1/analytics/vitals`
- Backend was returning `400 Bad Request` errors
- This caused console errors in production

**Root Cause:**
- The endpoint exists but doesn't accept the request format being sent
- The code was treating 400 as "endpoint exists" but still making requests

**Fix Applied:**
- Updated `src/lib/webVitals.ts` to disable the endpoint on 400 errors
- Now treats 400, 404, and 405 as "endpoint unavailable"
- Prevents future requests after first failure

**Files Changed:**
- `src/lib/webVitals.ts` (lines 52, 120)

**Status:** ✅ Fixed - Endpoint will be disabled automatically on 400 errors

---

### 2. ✅ Sidebar Not Scrollable in Production

**Problem:**
- Sidebar was scrollable on localhost but not when deployed online
- CSS `!important` rule was overriding inline `display: flex` style

**Root Cause:**
- CSS file had `display: block !important` at 1024px+ breakpoint
- Component uses `display: flex` inline style
- `!important` in CSS overrides inline styles, breaking flex layout
- Without flex layout, the scrollable container couldn't work properly

**Fix Applied:**
- Changed CSS from `display: block !important` to `display: flex !important`
- Maintains proper flex layout for scrolling to work

**Files Changed:**
- `src/components/layout/AppLayout.css` (line 21)

**Status:** ✅ Fixed - Sidebar should now scroll properly in production

---

## Backend Endpoint Check

### Analytics Vitals Endpoint

**Endpoint:** `POST /api/v1/analytics/vitals`

**Status:** ⚠️ **Needs Backend Review**

**Issue:** Backend is returning 400 Bad Request, suggesting:
1. Endpoint exists but request format is incorrect
2. Missing required fields in request body
3. Validation failing on backend

**Frontend Request Format:**
```json
{
  "name": "CLS|FCP|INP|LCP|TTFB",
  "value": 123.45,
  "rating": "good|needs-improvement|poor",
  "delta": 12.34,
  "id": "unique-id"
}
```

**Recommendation for Backend Team:**
1. Check if endpoint `/api/v1/analytics/vitals` exists
2. Verify it accepts POST requests
3. Check request validation rules
4. Either:
   - Fix validation to accept the current format, OR
   - Document the expected format and update frontend

**Location:** Backend should be in `/Users/narnolia/code/voms/`

---

## Other Endpoints Status

Based on codebase analysis, the following endpoints are actively used:

### Core Endpoints (Should be verified):
- ✅ `/api/v1/auth/login` - Authentication
- ✅ `/api/v1/auth/user` - Current user
- ✅ `/api/v2/gate-passes` - Gate pass list
- ✅ `/api/v1/expenses` - Expense list
- ✅ `/api/v1/inspection-templates` - Inspection templates
- ✅ `/api/v1/settings/report-branding` - Report branding
- ✅ `/gate-pass-approval/pending` - Pending approvals
- ✅ `/expense-approval/pending` - Expense approvals

### Optional/Non-Critical:
- ⚠️ `/api/v1/analytics/vitals` - Web vitals (now disabled on error)

---

## Testing Recommendations

1. **Test Sidebar Scrolling:**
   - Deploy to production
   - Open sidebar on desktop (1024px+)
   - Verify it scrolls when content overflows

2. **Test Analytics Vitals:**
   - Check browser console - should NOT see 400 errors
   - If endpoint is fixed, errors should stop appearing

3. **Backend Verification:**
   - Check Laravel routes: `php artisan route:list | grep analytics`
   - Verify `/api/v1/analytics/vitals` route exists
   - Check controller validation rules

---

## Next Steps

1. ✅ Frontend fixes are complete
2. ⏳ Backend team should review `/api/v1/analytics/vitals` endpoint
3. ⏳ Test sidebar scrolling in production environment
4. ⏳ Monitor console for any remaining errors

---

## Files Modified

1. `src/lib/webVitals.ts` - Disable endpoint on 400 errors
2. `src/components/layout/AppLayout.css` - Fix sidebar flex display

**Total Changes:** 2 files, 3 lines modified



